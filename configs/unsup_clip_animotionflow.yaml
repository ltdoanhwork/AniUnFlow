# Un/Semi-supervised config for AniFlowFormer-T (clip-based)
seed: 1337
workspace: outputs/aniflowformer_t_unsup
debug:
  detect_anomaly: true
# ========================= Data =========================
data:
  name: animerun_clip
  train_root: data/AnimeRun_v2/        # each subdir = one sequence
  val_root: data/AnimeRun_v2/
  img_exts: [".png", ".jpg", ".jpeg"]

  # Clip sampling
  T: 5                                  # odd length >= 3 (e.g., 5 or 7)
  stride_min: 1
  stride_max: 2

  # Resize/pad to a fixed canvas (divisible by 16 is safe)
  resize: true
  keep_aspect: true
  pad_mode: reflect
  crop_size: [368, 768]                 # (H, W) -> final canvas

  # Augmentations (applied consistently across the clip)
  color_jitter: [0.3, 0.3, 0.3, 0.1]    # brightness, contrast, saturation, hue
  do_flip: true
  grayscale_p: 0.1

  # Loader
  batch_size: 6
  num_workers: 4
  drop_last: true
  shuffle: true

# ========================= Model =========================
model:
  name: AniFlowFormerT
  args:
    enc_channels: 64
    token_dim: 192
    lcm_depth: 6
    lcm_heads: 4
    gtr_depth: 2
    gtr_heads: 4
    iters_per_level: 4
    use_sam: false                      # set true if you feed sam_masks in batches

# ========================= Optim =========================
optim:
  lr: 1.0e-4
  weight_decay: 1.0e-4
  epochs: 60
  clip: 1.0
  accum_steps: 1                        # increase if you need gradient accumulation
  scheduler:
    type: cosine                        # cosine | onecycle
    min_lr: 1.0e-6
    per_batch: false                    # true for OneCycle or per-batch cosine

# ========================= Loss =========================
loss:
  # Unsupervised losses (used via model.unsup_loss or Losses fallback)
  alpha_ssim: 0.2
  w_smooth: 0.1
  w_temp: 0.05
  w_cycle: 0.05

  # Semi-supervised term (only applied when GT flow is present in batch)
  w_epe_sup: 0.0                        # set >0 (e.g., 0.5 ~ 1.0) to enable semi-supervised

# ========================= Checkpointing =========================
ckpt:
  save_every: 1                         # save every N epochs
  keep_last: 5

# ========================= Logging & Viz =========================
logging:
  use_tb: true
  tb_dir: tb
  log_every: 200                        # step-wise logging interval

viz:
  enable: true
  max_samples: 8
  save_dir: val_vis
