# Lightweight Unsupervised Training Configuration (MDFlow / FastFlowNet)
# ========================================================
# Optimized for speed and baseline comparison.
# - No SAM-2 / Segment Guidance
# - FastFlowNet Model
# - Standard Unsupervised Losses
# - DRY RUN DEBUG CONFIG

seed: 1337
workspace: outputs/animerun_unsup_mdflow_dryrun

debug:
  detect_anomaly: false
  profile: false
  max_steps: 5
  max_val_steps: 2

# ========================= Data =========================
data:
  name: animerun_clip
  train_root: data/AnimeRun_v2/
  val_root: data/AnimeRun_v2/
  img_exts: [".png", ".jpg", ".jpeg"]

  # Clip sampling
  T: 3
  stride_min: 1
  stride_max: 2

  resize: true
  keep_aspect: true
  pad_mode: reflect
  crop_size: [384, 768]

  # Augmentations (Standard)
  color_jitter: [0.3, 0.3, 0.3, 0.1]
  do_flip: true
  grayscale_p: 0.1

  # Loader
  batch_size: 2  # Reduced batch size for dry run safety
  num_workers: 2
  drop_last: false
  shuffle: true

  # No SAM masks needed
  load_sam_masks: false
  sam_mask_dir: null
  generate_sam_masks: false

# ========================= Model =========================
model:
  name: FastFlowNet
  args:
    groups: 3

    # SAM-2 Integration: DISABLED
    use_sam: false
    use_segment_cost_modulation: false
    use_segment_attention_mask: false
    use_segment_refinement: false

# ========================= SAM-2 Configuration =========================
sam:
  enabled: false

# ========================= Optimization =========================
optim:
  # Standard OneCycle for baseline
  lr: 2.0e-4
  weight_decay: 1.0e-4
  betas: [0.9, 0.999]
  
  epochs: 1
  warmup_epochs: 0
  
  clip: 1.0
  accum_steps: 1

  scheduler:
    type: onecycle
    max_lr: 2.0e-4
    pct_start: 0.05
    anneal_strategy: linear
    cycle_momentum: false
    div_factor: 25.0
    final_div_factor: 10000.0

# ========================= Loss Configuration =========================
loss:
  # === Baseline Unsupervised Losses Only ===
  w_photo: 1.0
  alpha_ssim: 0.85
  w_smooth: 0.5
  w_cons: 0.05

  # === Disable Segment Losses ===
  segment_consistency:
    enabled: false
    weight: 0.0

  boundary_aware_smooth:
    enabled: false
    weight: 0.0

  temporal_memory:
    enabled: false
    weight: 0.0

  w_epe_sup: 0.0

# ========================= Validation =========================
validation:
  every_n_epochs: 1
  
  # Standard metrics matching lite config
  metrics:
    - epe
    - epe_occ
    - epe_nonocc
    - 1px
    - 3px
    - 5px

# ========================= Checkpointing =========================
ckpt:
  save_every: 1
  keep_last: 2
  save_best: false

# ========================= Logging =========================
logging:
  use_tb: false # Disable TB for dry run speed
  tb_dir: tb_animerun_mdflow
  log_every: 1 # Log every step
  
  log_flow_stats: true
  log_segment_stats: false
  log_occlusion_ratio: true
  log_individual_losses: true

viz:
  enable: false # Disable viz for dry run
  max_samples: 2
  save_dir: val_vis_mdflow
  save_flow_png: true

distributed:
  enabled: false
